<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Travel Planner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #f8f9fa;
    }
    
    .main-content {
      flex: 1;
    }
    
    .navbar-brand {
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .hero-section {
      background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://source.unsplash.com/1600x900/?travel,landmark');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 80px 0;
      margin-bottom: 30px;
    }
    
    .planning-card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin-bottom: 30px;
    }
    
    .feature-card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      height: 100%;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
    }
    
    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: #0d6efd;
    }
    
    .btn-primary {
      padding: 10px 20px;
      font-weight: 600;
    }
    
    .current-plan-alert {
      margin-top: 30px;
    }
    
    footer {
      background-color: #343a40;
      color: white;
      padding: 20px 0;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="/">Travel Planner</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/attractions">Attractions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/restaurants">Restaurants</a>
          </li>
          <!-- Auth buttons - these will be replaced by user info when logged in -->
          <li class="nav-item ms-3">
            <a class="btn btn-outline-light" href="https://us-east-1zjt65d7ot.auth.us-east-1.amazoncognito.com/login?client_id=3anj5rhtknc7i97jq3jgknai71&response_type=code&scope=email+openid+phone&redirect_uri=http%3A%2F%2Flocalhost%3A3000">Login</a>
          </li>
          <li class="nav-item ms-2">
            <a class="btn btn-outline-light" href="https://us-east-1zjt65d7ot.auth.us-east-1.amazoncognito.com/signup?client_id=3anj5rhtknc7i97jq3jgknai71&redirect_uri=http%3A%2F%2Flocalhost%3A3000&response_type=code&scope=email+openid+phone">Sign Up</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Hero Section -->
    <section class="hero-section text-center">
      <div class="container">
        <h1 class="display-4">Plan Your Perfect Trip</h1>
        <p class="lead">Discover amazing places to visit and restaurants to try at your next destination.</p>
      </div>
    </section>

    <!-- Planning Form Section -->
    <section class="container mb-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="planning-card">
            <h2 class="text-center mb-4">Create Your Trip Plan</h2>
            <form id="plan-form">
              <div class="mb-3">
                <label for="destination" class="form-label">Where are you going?</label>
                <input type="text" class="form-control" id="destination" placeholder="Enter city, country..." required>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="start-date" class="form-label">Start Date</label>
                  <input type="date" class="form-control" id="start-date">
                </div>
                <div class="col-md-6">
                  <label for="end-date" class="form-label">End Date</label>
                  <input type="date" class="form-control" id="end-date">
                </div>
              </div>
              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg px-4">Start Planning</button>
              </div>
            </form>
          </div>
          
          <!-- Current Plan Alert (hidden by default) -->
          <div id="current-plan-alert" class="alert alert-success current-plan-alert" role="alert" style="display: none;">
            <h4 class="alert-heading">Your current trip plan:</h4>
            <p id="current-plan-details">You're planning a trip to <span id="plan-destination"></span> from <span id="plan-dates"></span>.</p>
            <hr>
            <div class="d-flex justify-content-between">
              <a href="/itinerary" class="btn btn-outline-success">View Itinerary</a>
              <button id="clear-plan-btn" class="btn btn-outline-danger">Clear Plan</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="container mb-5">
      <h2 class="text-center mb-4">Plan Your Trip With Ease</h2>
      <div class="row g-4">
        <div class="col-md-4">
          <div class="card feature-card text-center p-4">
            <div class="card-body">
              <div class="feature-icon">üèõÔ∏è</div>
              <h3 class="card-title">Find Attractions</h3>
              <p class="card-text">Discover the best tourist spots, landmarks, museums, and more at your destination.</p>
              <a href="/attractions" class="btn btn-outline-primary">Explore Attractions</a>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card feature-card text-center p-4">
            <div class="feature-icon">üçΩÔ∏è</div>
            <h3 class="card-title">Discover Restaurants</h3>
            <p class="card-text">Find the best local cuisine, popular eateries, and hidden gems to satisfy your taste buds.</p>
            <a href="/restaurants" class="btn btn-outline-primary">Find Restaurants</a>
            </div>
          </div>
        <div class="col-md-4">
          <div class="card feature-card text-center p-4">
            <div class="feature-icon">üìù</div>
            <h3 class="card-title">Create Itinerary</h3>
            <p class="card-text">Organize your trip by saving attractions and restaurants to your personalized itinerary.</p>
            <a href="/itinerary" class="btn btn-outline-primary">View Itinerary</a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>




  
  <!-- Footer -->
  <footer class="text-center py-4">
    <div class="container">
      <p class="mb-0">¬© 2025 Travel Planner. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
  const planForm = document.getElementById('plan-form');
  const currentPlanAlert = document.getElementById('current-plan-alert');
  const planDestination = document.getElementById('plan-destination');
  const planDates = document.getElementById('plan-dates');
  const clearPlanBtn = document.getElementById('clear-plan-btn');
  const startDateInput = document.getElementById('start-date');
  const endDateInput = document.getElementById('end-date');

  // Set min date for start date (today)
  const today = new Date().toISOString().split('T')[0];
  startDateInput.setAttribute('min', today);
  
  // Disable end date until start date is selected
  endDateInput.setAttribute('disabled', true);
  
  // When start date changes, update end date constraints
  startDateInput.addEventListener('change', function() {
    if (startDateInput.value) {
      // Enable end date input
      endDateInput.removeAttribute('disabled');
      
      // Set minimum date for end date input (should be the start date)
      endDateInput.setAttribute('min', startDateInput.value);
      
      // If end date is before start date, reset it
      if (endDateInput.value && endDateInput.value < startDateInput.value) {
        endDateInput.value = '';
      }
    } else {
      // If start date is cleared, disable end date
      endDateInput.setAttribute('disabled', true);
      endDateInput.value = '';
    }
  });

  // Format dates for display
  function formatDateRange(startDate, endDate) {
    if (!startDate && !endDate) return 'dates not specified';
    if (!startDate) return `until ${new Date(endDate).toLocaleDateString()}`;
    if (!endDate) return `starting ${new Date(startDate).toLocaleDateString()}`;
    
    return `${new Date(startDate).toLocaleDateString()} to ${new Date(endDate).toLocaleDateString()}`;
  }

  function showWeatherForDateRange(forecast, startDate, endDate) {
  const weatherSection = document.createElement('section');
  weatherSection.className = 'container mb-5';
  weatherSection.innerHTML = `
    <h2 class="text-center mb-4">Rain Forecast During Your Trip</h2>
    <ul id="weather-results" class="list-group"></ul>
  `;
  document.querySelector('.main-content').appendChild(weatherSection);

  const resultList = document.getElementById('weather-results');
  const start = new Date(startDate);
  const end = new Date(endDate);

  const entries = forecast.filter(entry => {
    const entryDate = new Date(entry.datetime);
    return entryDate >= start && entryDate <= end;
  });

  if (entries.length === 0) {
    resultList.innerHTML = '<li class="list-group-item">No rain forecasted during your trip dates üéâ</li>';
    return;
  }

  entries.forEach(entry => {
    const item = document.createElement('li');
    item.className = 'list-group-item';
    item.innerHTML = `
      <strong>${new Date(entry.datetime).toLocaleString()}</strong><br>
      ‚òî <strong>Rain:</strong> ${entry.rainVolume} mm<br>
      üå°Ô∏è <strong>Temp:</strong> ${entry.temp}¬∞C<br>
      üå§Ô∏è <strong>Forecast:</strong> ${entry.weather}
    `;
    resultList.appendChild(item);
  });
}


  // Check if there's an existing plan
  fetch('/api/plan')
    .then(response => response.json())
    .then(data => {
      if (data.plan) {
        // Pre-fill the form
        document.getElementById('destination').value = data.plan.destination || '';
        
        // Set start date if it exists
        if (data.plan.startDate) {
          startDateInput.value = data.plan.startDate;
          // Enable end date if start date exists
          endDateInput.removeAttribute('disabled');
          endDateInput.setAttribute('min', startDateInput.value);
        }
        
        // Set end date if it exists
        if (data.plan.endDate) {
          endDateInput.value = data.plan.endDate;
        }
        
        // Show current plan alert
        planDestination.textContent = data.plan.destination;
        planDates.textContent = formatDateRange(data.plan.startDate, data.plan.endDate);
        currentPlanAlert.style.display = 'block';
      }
    })
    .catch(error => console.error('Error loading plan:', error));

  // Handle form submission
  planForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const destination = document.getElementById('destination').value;
    const startDate = startDateInput.value;
    const endDate = endDateInput.value;
    
    // Validate dates
    if (endDate && !startDate) {
      alert('Please select a start date before selecting an end date.');
      return;
    }
    
    if (endDate && startDate && new Date(endDate) < new Date(startDate)) {
      alert('End date cannot be before start date.');
      return;
    }
    
    fetch('/api/plan', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        destination,
        startDate,
        endDate
      }),
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Update current plan display
        planDestination.textContent = destination;
        planDates.textContent = formatDateRange(startDate, endDate);
        currentPlanAlert.style.display = 'block';
        
          // Fetch weather forecast
      fetch(`/api/weather?city=${encodeURIComponent(destination)}`)
        .then(res => res.json())
        .then(weatherData => {
          showWeatherForDateRange(weatherData.forecast, startDate, endDate);
        });


        // Optional: redirect to attractions page
        window.location.href = '/attractions';
      }
    })
    .catch(error => console.error('Error saving plan:', error));
  });

  // Handle clear plan button
  clearPlanBtn.addEventListener('click', function() {
    if (confirm('Are you sure you want to clear your current trip plan?')) {
      fetch('/api/plan', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          destination: '',
          startDate: '',
          endDate: ''
        }),
      })
      .then(() => {
        // Reset form
        planForm.reset();
        // Reset date inputs
        endDateInput.setAttribute('disabled', true);
        // Hide current plan alert
        currentPlanAlert.style.display = 'none';
      })
      .catch(error => console.error('Error clearing plan:', error));
    }
  });
});


document.getElementById('get-weather-btn').addEventListener('click', () => {
  const city = document.getElementById('weather-city').value.trim();
  const resultList = document.getElementById('weather-results');
  resultList.innerHTML = '';

  if (!city) return alert('Please enter a city');

  fetch(`/api/weather?city=${encodeURIComponent(city)}`)
    .then(res => res.json())
    .then(data => {
      if (!data.forecast || data.forecast.length === 0) {
        resultList.innerHTML = '<li class="list-group-item">No rain forecasted in the next 5 days.</li>';
        return;
      }

      data.forecast.forEach(entry => {
        const item = document.createElement('li');
        item.className = 'list-group-item';
        item.innerHTML = `
          <strong>${new Date(entry.datetime).toLocaleString()}</strong><br>
          ‚òî <strong>Rain:</strong> ${entry.rainVolume} mm<br>
          üå°Ô∏è <strong>Temp:</strong> ${entry.temp}¬∞C<br>
          üå§Ô∏è <strong>Forecast:</strong> ${entry.weather}
        `;
        resultList.appendChild(item);
      });
    })
    .catch(err => {
      console.error(err);
      resultList.innerHTML = '<li class="list-group-item text-danger">Error fetching weather data.</li>';
    });
});



  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="/js/weather.js"></script>
<script>
  // Fetch current plan
  fetch('/api/plan')
    .then(res => res.json())
    .then(data => {
      if (data.plan && data.plan.destination) {
        const { destination, startDate, endDate } = data.plan;
        fetch(`/api/weather?city=${encodeURIComponent(destination)}`)
          .then(res => res.json())
          .then(weatherData => {
            showWeatherForDateRange(weatherData.forecast, startDate, endDate, '.main-content');
          });
      }
    })
    .catch(err => console.error('Weather load error:', err));
</script>


<script src="/js/auth.js"></script>
</body>
</html>